<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>공릉동 네모하우스 호실 현황</title>
    <style>
        /* 기존 스타일 유지 */
        .save-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        .save-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <!-- 기존 HTML 코드 유지 -->
    <script>
        const ADMIN_PASSWORD = '2485';
        const loginOverlay = document.getElementById('login-overlay');
        const passwordInput = document.getElementById('password-input');
        let isAdminMode = false;

        // 데이터 저장 및 로드 함수 추가
        function saveRoomData(roomNumber, data) {
            localStorage.setItem(`room_${roomNumber}`, JSON.stringify(data));
        }

        function loadRoomData(roomNumber) {
            const data = localStorage.getItem(`room_${roomNumber}`);
            return data ? JSON.parse(data) : null;
        }

        function checkPassword() {
            if (passwordInput.value === ADMIN_PASSWORD) {
                loginOverlay.style.display = 'none';
                isAdminMode = true;
                renderBuilding();
            } else {
                alert('비밀번호가 틀렸습니다.');
                passwordInput.value = '';
            }
        }

        function switchToReadOnly() {
            isAdminMode = false;
            renderBuilding();
        }

        function switchToAdminView() {
            loginOverlay.style.display = 'flex';
        }

        const statusStates = ['vacant', 'occupied', 'expiring'];
        const statusTexts = {
            'vacant': '공실',
            'occupied': '계약중',
            'expiring': '만료예정'
        };

        const floors = [
            { name: '3층', rooms: ['301', '302', '303', '304'] },
            { name: '2층', rooms: ['201', '202', '203', '204'] },
            { name: '1층', rooms: ['101', '102', '103', '104'] },
            { name: '지하1층', rooms: ['B01', 'B02', 'B03', 'B04'] }
        ];

        function createDateSelectors(prefix) {
            const currentYear = new Date().getFullYear();
            const yearRange = Array.from({length: 10}, (_, i) => currentYear + i);
            const months = Array.from({length: 12}, (_, i) => i + 1);
            const days = Array.from({length: 31}, (_, i) => i + 1);

            return `
                <div class="date-group">
                    <select class="${prefix}-year" ${isAdminMode ? '' : 'disabled'}>
                        <option value="">년</option>
                        ${yearRange.map(year => `<option value="${year}">${year}</option>`).join('')}
                    </select>
                    <select class="${prefix}-month" ${isAdminMode ? '' : 'disabled'}>
                        <option value="">월</option>
                        ${months.map(month => `<option value="${month}">${month}</option>`).join('')}
                    </select>
                    <select class="${prefix}-day" ${isAdminMode ? '' : 'disabled'}>
                        <option value="">일</option>
                        ${days.map(day => `<option value="${day}">${day}</option>`).join('')}
                    </select>
                </div>`;
        }

        function renderBuilding() {
            const buildingDiv = document.querySelector('.building');
            buildingDiv.innerHTML = ''; 
            
            floors.forEach(floor => {
                const floorHTML = `
                    <div class="floor" data-floor="${floor.name}">
                        ${floor.rooms.map(roomNumber => {
                            const savedData = loadRoomData(roomNumber);
                            return `
                            <div class="room-container">
                                <div class="room ${savedData ? savedData.status : 'vacant'}" data-room="${roomNumber}" data-status="${savedData ? savedData.status : 'vacant'}">
                                    <div class="room-header">${roomNumber}호</div>
                                    <div class="status-text">${savedData ? statusTexts[savedData.status] : '공실'}</div>
                                </div>
                                ${isAdminMode ? `
                                <div class="contract-period">
                                    <label>계약시작일</label>
                                    ${createDateSelectors('start')}
                                    <label>계약종료일</label>
                                    ${createDateSelectors('end')}
                                    <label>세입자 전화번호</label>
                                    <input type="text" class="tenant-phone-input" placeholder="010-0000-0000" value="${savedData ? savedData.tenantPhone : ''}">
                                    <button class="save-button" onclick="saveCurrentRoomData('${roomNumber}')">저장</button>
                                </div>` : `
                                <div class="contract-period-view">
                                    <div class="start-date-view">${savedData ? `계약시작: ${savedData.startDate}` : ''}</div>
                                    <div class="end-date-view">${savedData ? `계약종료: ${savedData.endDate}` : ''}</div>
                                    <div class="tenant-phone">${savedData ? `세입자 전화번호: ${savedData.tenantPhone}` : ''}</div>
                                </div>`}
                            </div>
                        `}).join('')}
                    </div>
                `;
                buildingDiv.innerHTML += floorHTML;
            });

            setupRoomEvents();
        }

        function saveCurrentRoomData(roomNumber) {
            const container = document.querySelector(`.room-container [data-room="${roomNumber}"]`).closest('.room-container');
            const startYear = container.querySelector('.start-year').value || '미입력';
            const startMonth = container.querySelector('.start-month').value || '';
            const startDay = container.querySelector('.start-day').value || '';
            const endYear = container.querySelector('.end-year').value || '미입력';
            const endMonth = container.querySelector('.end-month').value || '';
            const endDay = container.querySelector('.end-day').value || '';
            const tenantPhone = container.querySelector('.tenant-phone-input').value || '미입력';
            const currentStatus = container.querySelector('.room').dataset.status;
            
            const startDate = startYear !== '미입력' ? `${startYear}년 ${startMonth}월 ${startDay}일` : '미입력';
            const endDate = endYear !== '미입력' ? `${endYear}년 ${endMonth}월 ${endDay}일` : '미입력';

            const roomData = {
                status: currentStatus,
                startDate: startDate,
                endDate: endDate,
                tenantPhone: tenantPhone
            };

            saveRoomData(roomNumber, roomData);
            alert('저장되었습니다.');
            renderBuilding();
        }

        function setupRoomEvents() {
            const rooms = document.querySelectorAll('.room');
            rooms.forEach(room => {
                const newRoom = room.cloneNode(true);
                room.parentNode.replaceChild(newRoom, room);

                if (isAdminMode) {
                    newRoom.addEventListener('click', function(e) {
                        const currentStatus = this.dataset.status;
                        const currentIndex = statusStates.indexOf(currentStatus);
                        const nextIndex = (currentIndex + 1) % statusStates.length;
                        const nextStatus = statusStates[nextIndex];
                        
                        this.dataset.status = nextStatus;
                        this.className = `room ${nextStatus}`;
                        this.querySelector('.status-text').textContent = statusTexts[nextStatus];
                    });
                } else {
                    newRoom.style.cursor = 'not-allowed';
                }
            });
        }

        // 초기 렌더링
        renderBuilding();
    </script>
</body>
</html>
